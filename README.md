# kube-test-case


ip-адрес и ключ ноды: inventory/hosts/kube-node-1.yml
ip-адрес и ключ мастера: inventory/hosts/kube-controller.yml

### Ход процесса
1) вызываем site.yml
2) из него переходим в playbooks/kubernetes/site.yml
3) при необходимости ставим python
4) переходим в роль kubernetes-role (roles/kubernetes-node/tasks/main.yml), выполняем задачи там
5) переходим в плейбук roles/kubernetes-node/tasks/join.yml, если на хосте нет подтверждения что нода в кластере (я использовал создание файла как флаг)
6) все хендлеры в roles/kubernetes-node/handlers/main.yml

### Запуск
* установить на хост pipenv
* pipenv sync && pipenv shell
* ansible-playbook -i inventory site.yml -vD

### Расхождения с предоставленным bash-скриптом (ТЗ):
* объединил схожие действия, немного поменял местами
* процесс создания токена другой (без bash-строки)

### Возможности для улучшения:
* сделать перезапуск каждого компонента отдельно при изменении его конфигурации
* использовать динамический inventory и брать ip из внешних источников
* устанавливать CNI
* проверять DNS, если там включено создание адресов для нод
* настраивать hostname и прочее у ноды (сейчас он выдаёт предупреждения), отключать swap принудительно, настраивать тома LVM
* возможно как-то управлять конфигом kubelet
